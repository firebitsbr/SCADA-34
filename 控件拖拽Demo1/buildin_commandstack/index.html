<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">

	<head>
		<title></title>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="viewport" content="width=device-width, minimum-scale=1.0" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

		<link type="text/css" rel="stylesheet" href="./css/aristo/jquery-ui-1.8.16.custom.css" />
		<link type="text/css" rel="stylesheet" href="./css/jquery.layout.css" />
		<link type="text/css" rel="stylesheet" href="./css/application.css" />
		<link type="text/css" rel="stylesheet" href="./css/contextmenu.css" />

		<!-- 必须导入的12个JS -->
		<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="js/canvg.js"></script>
		<script type="text/javascript" src="js/Class.js"></script>
		<script type="text/javascript" src="js/jquery.autoresize.js"></script>
		<script type="text/javascript" src="js/jquery.contextmenu.js"></script>
		<script type="text/javascript" src="js/jquery-touch_punch.js"></script>
		<script type="text/javascript" src="js/json2.js"></script>
		<script type="text/javascript" src="js/pathfinding-browser.min.js"></script>
		<script type="text/javascript" src="js/raphael.js"></script>
		<script type="text/javascript" src="js/rgbcolor.js"></script>
		<script type="text/javascript" src="js/shifty.js"></script>
		<script type="text/javascript" src="js/draw2d.js"></script>

		<SCRIPT src="./lib/jquery.browser.js"></SCRIPT>
		<SCRIPT src="./lib/jquery-ui-1.8.23.custom.min.js"></SCRIPT>
		<SCRIPT src="./lib/jquery.layout.js"></SCRIPT>

		<SCRIPT src="./gui/Application.js"></SCRIPT>
		<SCRIPT src="./gui/View.js"></SCRIPT>
		<SCRIPT src="./gui/Toolbar.js"></SCRIPT>
		<SCRIPT src="./gui/HoverConnection.js"></SCRIPT>
		<!--图片选择-->
		<script type="text/javascript" src="gui/choseImage.js" ></script>

		<!-- 自定义控件 -->
		<!-- // <script type="text/javascript" src="draw2d.shape.basic.Rectangle.js"></script>  -->
		<SCRIPT src="LabelRectangle.js"></SCRIPT>
		<!--添加上下左右的例子-->
		<script src="LabeledEnd.js"></script>
		<!-- 添加带图片的例子 -->
		<script src="LabelRectangleWithImage.js"></script>

		<script type="text/javascript">

			var jsonDocument = [
  {
    "type": "draw2d.shape.node.End",
    "id": "a64b9f87-1347-1c00-b454-85bff7483873",
    "x": 293,
    "y": 68,
    "width": 50,
    "height": 50,
    "alpha": 1,
    "angle": 0,
    "userData": {},
    "cssClass": "draw2d_shape_node_End",
    "ports": [
      {
        "type": "draw2d.InputPort",
        "id": "e4e1e38f-757e-ddc7-eb06-1eda1a8a0bb1",
        "width": 10,
        "height": 10,
        "alpha": 1,
        "angle": 0,
        "userData": {},
        "cssClass": "draw2d_InputPort",
        "bgColor": "#4F6870",
        "color": "#1B1B1B",
        "stroke": 1,
        "dasharray": null,
        "maxFanOut": 9007199254740991,
        "name": "input0",
        "port": "draw2d.InputPort",
        "locator": "draw2d.layout.locator.InputPortLocator"
      }
    ],
    "bgColor": "#4D90FE",
    "color": "#000000",
    "stroke": 1,
    "radius": 0,
    "dasharray": null
  },
  {
    "type": "draw2d.shape.node.Start",
    "id": "e520e55b-1c44-de7a-27f8-436b6d712576",
    "x": 418,
    "y": 57,
    "width": 50,
    "height": 50,
    "alpha": 1,
    "angle": 0,
    "userData": {},
    "cssClass": "draw2d_shape_node_Start",
    "ports": [
      {
        "type": "draw2d.OutputPort",
        "id": "a810d895-a9b2-605a-38f2-b46aa2358d16",
        "width": 10,
        "height": 10,
        "alpha": 1,
        "angle": 0,
        "userData": {},
        "cssClass": "draw2d_OutputPort",
        "bgColor": "#4F6870",
        "color": "#1B1B1B",
        "stroke": 1,
        "dasharray": null,
        "maxFanOut": 9007199254740991,
        "name": "output0",
        "port": "draw2d.OutputPort",
        "locator": "draw2d.layout.locator.OutputPortLocator"
      }
    ],
    "bgColor": "#4D90FE",
    "color": "#000000",
    "stroke": 1,
    "radius": 0,
    "dasharray": null
  },
  {
    "type": "LabelRectangle",
    "id": "a7eff919-8eb0-e4ca-ed66-f6428819e862",
    "x": 515,
    "y": 55,
    "width": 100,
    "height": 100,
    "alpha": 1,
    "angle": 0,
    "userData": {},
    "cssClass": "LabelRectangle",
    "ports": [],
    "bgColor": "#A0A0A0",
    "color": "#1B1B1B",
    "stroke": 1,
    "radius": 0,
    "dasharray": null
  }
]




			$(window).load(function() {
				draw2d.Configuration.factory.createConnection = function(sourcePort, targetPort, callback, dropTarget) {
					return new HoverConnection(sourcePort, targetPort);
				};
				var app = new example.Application();
				var canvas = app.view;
				// console.log(canvas);
				//添加范围限制---------Bug待定
				var reader = new draw2d.io.json.Reader();
				reader.unmarshal(canvas, jsonDocument);
				//获取控件的信息

				/*
				*获得ID对应的节点对象
				*/
				var node  = canvas.getFigure("a7eff919-8eb0-e4ca-ed66-f6428819e862"); //
				// canvas.remove(node);
				// console.log(canvas.getFigure("a7eff919-8eb0-e4ca-ed66-f6428819e862"));
				/*
				*更改节点对象的属性
				*/
				console.log(node.bgColor);
				node.bgColor.hashString = "#4D90FE";

				/*
				*重新绘制本节点
				*/
				node.repaint();
				console.log(node.bgColor);



				canvas.getCommandStack().addEventListener(function(e) {
					if (e.isPostChangeEvent()) {
						displayJSON(canvas);
						
					}
				});

			







			});



			function RemoveAndaddNode (canvas,nodes) {
				// var node = this.view.getCurrentSelection();
				// var command = new draw2d.command.CommandDelete(node);
				// this.view.getCommandStack().execute(command);
				console.log("success!!!")
				// var node = $("#a7eff919-8eb0-e4ca-ed66-f6428819e862");
				
				 // canvas.on("node:remove", function(emitter, event){
    	// 			alert("figure remove:");
 				// 	});
					canvas.remove(node);
			}


			function displayJSON(canvas) {
				var writer = new draw2d.io.json.Writer();
				writer.marshal(canvas, function(json) {
					// $("#json").text(JSON.stringify(json, null, 2));
					// var color = new draw2d.util.Color(255, 102, 102);
					console.log(JSON.stringify(json, null, 2));
					// for (var i =0; i < json.length; i++)
					// {
					// console.log(json[0].id);
					// var noo = json[0].id;
					// RemoveAndaddNode(canvas,noo);

					// json[i].bgColor = "#f0f000";
					// console.log(json[i].bgColor);
					// json[i].alpha = 0;
					// };
					// canvas.clear();
					// var reader = new draw2d.io.json.Reader();
					// reader.unmarshal(canvas, json);
					// console.log(json[0].id);
				});
			}
		</script>

	</head>

	<body id="container">

   <div id="content">
   		<div id="toolbar"></div>
   		<div id="canvas" class="" style="width:200px; height:1000px;">
   		<img id="myBgimage" src="img/Desert.jpg" />
   		</div>

   </div>
    <script type="text/javascript">
      $(function(){

        var widths = $(document.body).width()*8/9;
        var heights = $(document).height()*3/4;
        $("#canvas").css({"width":widths+"px","height":heights+"px"});
        $("#myBgimage").css({"width":widths+"px","height":heights+"px"});
      })

      </script>

		<div id="navigation" class="">
			<div data-shape="draw2d.shape.node.Start" class="palette_node_element draw2d_droppable">Start</div>
			<div data-shape="draw2d.shape.node.End" class="palette_node_element draw2d_droppable">End</div>
			<div data-shape="draw2d.shape.node.Between" class="palette_node_element draw2d_droppable">Between</div>
			<div data-shape="LabelRectangle" class="palette_node_element draw2d_droppable">中央注释</div>
			<div data-shape="LabeledEnd" class="palette_node_element draw2d_droppable">下面标题</div>
			<div data-shape="LabelRectangleWithImage" class="palette_node_element draw2d_droppable">带图片</div>
		</div>

	</body>

</html>