<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">

	<head>
		<title></title>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="viewport" content="width=device-width, minimum-scale=1.0" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

		<link type="text/css" rel="stylesheet" href="./css/aristo/jquery-ui-1.8.16.custom.css" />
		<link type="text/css" rel="stylesheet" href="./css/jquery.layout.css" />
		<link type="text/css" rel="stylesheet" href="./css/application.css" />
		<link type="text/css" rel="stylesheet" href="./css/contextmenu.css" />

		<!-- 必须导入的12个JS -->
		<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="js/canvg.js"></script>
		<script type="text/javascript" src="js/Class.js"></script>
		<script type="text/javascript" src="js/jquery.autoresize.js"></script>
		<script type="text/javascript" src="js/jquery.contextmenu.js"></script>
		<script type="text/javascript" src="js/jquery-touch_punch.js"></script>
		<script type="text/javascript" src="js/json2.js"></script>
		<script type="text/javascript" src="js/pathfinding-browser.min.js"></script>
		<script type="text/javascript" src="js/raphael.js"></script>
		<script type="text/javascript" src="js/rgbcolor.js"></script>
		<script type="text/javascript" src="js/shifty.js"></script>
		<script type="text/javascript" src="js/draw2d.js"></script>

		<SCRIPT src="./lib/jquery.browser.js"></SCRIPT>
		<SCRIPT src="./lib/jquery-ui-1.8.23.custom.min.js"></SCRIPT>
		<SCRIPT src="./lib/jquery.layout.js"></SCRIPT>

		<SCRIPT src="./gui/Application.js"></SCRIPT>
		<SCRIPT src="./gui/View.js"></SCRIPT>
		<SCRIPT src="./gui/Toolbar.js"></SCRIPT>
		<SCRIPT src="./gui/HoverConnection.js"></SCRIPT>
		<!--<script src="/gui/zidingyi.js"></script>-->
		<script type="text/javascript" src="gui/choseImage.js" ></script>

		<!-- 自定义控件 -->
		<!-- // <script type="text/javascript" src="draw2d.shape.basic.Rectangle.js"></script>  -->
		<SCRIPT src="LabelRectangle.js"></SCRIPT>
		<!--添加上下左右的例子-->
		<script src="LabeledEnd.js"></script>
		<!-- 添加带图片的例子 -->
		<script src="LabelRectangleWithImage.js"></script>

		<script type="text/javascript">
			$(window).load(function() {
				draw2d.Configuration.factory.createConnection = function(sourcePort, targetPort, callback, dropTarget) {
					return new HoverConnection(sourcePort, targetPort);
				};
				var app = new example.Application();
				var canvas = app.view;
				// console.log(canvas);
				//添加范围限制---------Bug待定
				// var reader = new draw2d.io.json.Reader();
				// reader.unmarshal(canvas, jsonDocument);
				//获取控件的信息
				canvas.getCommandStack().addEventListener(function(e) {
					if (e.isPostChangeEvent()) {
						displayJSON(canvas);
					}
				});
			});

			function displayJSON(canvas) {
				var writer = new draw2d.io.json.Writer();
				writer.marshal(canvas, function(json) {
					// $("#json").text(JSON.stringify(json, null, 2));
					// var color = new draw2d.util.Color(255, 102, 102);
					console.log(JSON.stringify(json, null, 2));
					// for (var i =0; i < json.length; i++)
					// {
					// console.log(json[i].id);
					// json[i].bgColor = "#f0f000";
					// console.log(json[i].bgColor);
					// json[i].alpha = 0;
					// };
					// canvas.clear();
					// var reader = new draw2d.io.json.Reader();
					// reader.unmarshal(canvas, json);
					// console.log(json[0].id);
				});
			}
		</script>

	</head>

	<body id="container">

   <div id="content">
   		<div id="toolbar"></div>
   		<div id="canvas" class="" style="width:200px; height:1000px;">
   		<img id="myBgimage" src="img/Desert.jpg" />
   		</div>

   </div>
    <script type="text/javascript">
      $(function(){

        var widths = $(document.body).width()*8/9;
        var heights = $(document).height()*3/4;
        $("#canvas").css({"width":widths+"px","height":heights+"px"});
        $("#myBgimage").css({"width":widths+"px","height":heights+"px"});
      })

      </script>

		<div id="navigation" class="">
			<div data-shape="draw2d.shape.node.Start" class="palette_node_element draw2d_droppable">Start</div>
			<div data-shape="draw2d.shape.node.End" class="palette_node_element draw2d_droppable">End</div>
			<div data-shape="draw2d.shape.node.Between" class="palette_node_element draw2d_droppable">Between</div>
			<div data-shape="LabelRectangle" class="palette_node_element draw2d_droppable">中央注释</div>
			<div data-shape="LabeledEnd" class="palette_node_element draw2d_droppable">下面标题</div>
			<div data-shape="LabelRectangleWithImage" class="palette_node_element draw2d_droppable">带图片</div>
		</div>

	</body>

</html>